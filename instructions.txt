PART1-----------------------------------------------------------------------

INSTALLATION: 

Get the latest version of you Linux distribution, in my case Debian :
https://www.debian.org/releases/stretch/debian-installer/
(if you are working at 42, be careful of where you put your VM, you need to
change that parametre in the VirtualBox app : 
Preference->General->Default Machine Folder->~/goinfre)
Make a VHD of 8.6 GO to have a vm of 8.0 GO, and a separated /home partition, it
will automaticaly set around 4.2 GO but you can edit that later with cfdisk later.

# PACKAGES:
# (to list all installed : 
# $ sudo dpkg-query --list / $ sudo service --status-all)
# sudo
# net-tools
# openssh-server
# ufw
# fail2ban
# git (to download slowloris)
# perl (required by slowloris)
# libwww-mechanize-shell-perl (required by slowloris)
# perl-doc (to read the slowloris's man)


PART2-----------------------------------------------------------------------

CREATE A NO ROOT USER TO CONNECT AND WORK AND MAKE IT SUDOER

Log as root : $ su -
Update packages list : $ apt-get update
Install sudo package : $ apt-get install sudo
If the user have not been created during the installation :
$ adduser $USERID (dev) $GROUPID (sudo)
If the user has been created during installation : 
$ usermod -aG sudo $USER, or $ visudo


CONFIGURE STATIC IP ADDRESS WITH NETMASK /30 (man interfaces)

Turn on your VM and find the names of your network interfaces :
$ ip a, or $ ifconfig -a (need net-tools package), or $ ls /sys/class/net/
(since 2009 a Consistent Network Device Naming convention was adopted for
naming Ethernet adapters in Linux, that's why maybe you have enp0s3
instead of eth0), for easy setup get the ip and the
gateway assigned by dhcp protocol ($ ip a, $ route)

Edit /etc/network/interfaces to setup static ip preferences
(https://wiki.debian.org/NetworkConfiguration#Configuring_the_interface_manually)

# If you have network-manager package installed, you can use the :
# $ nm-connection-editor GUI to configure your network interfaces
# to do that you need to disable or delete network-manager package
# The 'modern' way is to create a dhcp.network and a static.network in
# /etc/systemd/network (https://www.debian.org/doc/manuals/debian-reference/ch05.fr.html#_the_modern_network_configuration_without_gui).
# Last, but not least, way to configure your network is by using
# $ ip address commands (https://memo-linux.com/ip-la-commande-linux-pour-gerer-son-interface-reseau/)

Shutdown your VM :
$ poweroff
On the VitualBox GUI go to your VM Preferences, select Network, select
Adaptater 1, switch to Bridge Adaptator then select en0

# Remove all IP v4 addresses on all the Ethernet interfaces :
# $ ip -4 address flush label "enp*"
# Restart the network for your changes to be effective :
# $ sudo service networking restart (/etc/init.d/networking)
# Activate enp0s3 network
# $ ifup enp0s3

Cool links :
https://chrtophe.developpez.com/tutoriels/gestion-reseau-machine-virtuelle/
https://www.faistesbalises.net/os/16/tuto-installer-debian-sous-virtualbox-en-s-affranchissant-des-additions-invite.html
https://formation-debian.viarezo.fr/ip.html
http://jodies.de/ipcalc
https://www.aelius.com/njh/subnet_sheet.html


CHANGE DEFAULT SSH PORT, SSH ACCESS BY PUBLICKEYS, ROOT MUST CAN'T SSH

Install : $ apt-get install openssh-server, packageif not already installed
Check if active : $ service ssh status
Copy your rsa_publickey using $ ssh-copy-id user@guestmachine
(https://www.digitalocean.com/community/tutorials/how-to-set-up-ssh-keys-on-debian-9)
Edit /etc/ssh/sshd_config to setup your preferences : 
Port 2222
PermitRootLogin no
PubkeyAuthentication yes
PasswordAuthentication no
reboot ssh : $ service ssh restart
On the host machine log in : $ ssh@10.11.12.0 -p 2222

Cool links :
https://wiki.debian.org/fr/SSH


FIREWALL

Install ufw (Uncomplicated Firewall) : $ apt-get install ufw
Allow port 2222 (ssh) : $ ufw allow 2222
Allow port 80 (http) : $ ufw allow 80
Allow port 443 (https) : $ ufw allow 443

Cool links :
https://www.digitalocean.com/community/tutorials/how-to-set-up-a-firewall-with-ufw-on-ubuntu-16-04
https://debian-facile.org/doc:systeme:ufw

DDoS

Install : $apt-get install fail2ban
Check your iptables rules : $ sudo iptables -S | grep f2b, by default port 22 is 
watched for ssh, you need to change that by editing
/etc/fail2ban/jail.d/defaults-debian.conf
/*
[DEFAULT]
destemail = cmiran@student.42.fr

[sshd]
enabled = true
port = 2222

[sshd-ddos]
enabled = true
port = 2222
*/
To list all jails : $ fail2ban-client status

Test that with slowloris (https://github.com/llaera/slowloris.pl)

Cool link :
https://wiki.debian-fr.xyz/Fail2ban
? https://gist.github.com/SamStudio8/92507ad3e317edb9b869c20bb2623fcf ?
? https://javapipe.com/blog/iptables-ddos-protection/ ?


fail2ban ou ufw pour proteger contre les scans de port


arreter un service avec systemd
